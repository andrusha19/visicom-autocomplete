let visicomAutoComplete=function(){return function(e){let t={selector:"#visicom-autocomplete",apiUrl:"https://api.visicom.ua/data-api/4.0/{lang}/",apiKey:"",placeholder:"Search...",minChars:3,delay:150,width:"400px",height:"35px",map:null,marker:null,suggestsLimit:5,lang:"local",onSuggestSelected:e=>console.log("Suggest selected: "+e.html)},n=u((t=Object.assign({},t,e)).selector);if(!n)return void console.log(`Couldn't find element with '${t.selector}' selector.`);if(!t.apiKey)return void console.log("You didn't specify your API key.");let l=n.innerHTML.trim();n.classList.add("visicom-autocomplete"),n.style.width=t.width,n.style.height=t.height;let r=document.createElement("input");r.placeholder=t.placeholder,r.setAttribute("autocomplete","off"),r.setAttribute("autocorrect","off"),r.setAttribute("autocapitalize","off"),r.setAttribute("spellcheck","false");let a=document.createElement("div");a.classList.add("suggests");let o=document.createElement("button");if(o.classList.add("close"),o.style.width=t.height,o.style.height=t.height,n.appendChild(r),n.appendChild(a),n.appendChild(o),!l||!l.includes('href="https://api.visicom.ua/"'))return void console.log("Visicom link not available.");n.removeChild(n.firstElementChild);let i=[],s=-1,c=null;if(t.map&&!t.marker)if("undefined"==typeof L||null===L)console.log("Leaflet object is not available.");else{let e='<svg xmlns="http://www.w3.org/2000/svg" \n                                        width="24" height="24" viewBox="0 0 24 24">\n\n                                    <defs>         \n                                        <filter id="blur1" x="-100%" y="-100%" width="400%" height="400%">             \n                                            <feGaussianBlur stdDeviation="2"></feGaussianBlur>\n                                        </filter>\n                                    </defs>\n                                    \n                                    <style>\n                                        .selected-bg {\n                                            fill: #808080;\n                                            filter: url(#blur1);\n                                        }\n                                        .selected-fill {\n                                            fill: #ffffff;\n                                            stroke: #ff0000;\n                                            stroke-width: 1.7px;\n                                        }\n                                    </style>    \n\n                                    <g>\n                                        <circle class="selected-bg" cx="12" cy="12" r="9"/>           \n                                        <circle class="selected-fill" cx="11" cy="11" r="9" />\n                                        <path fill="#ff0000" d="m11 5.7c-2.1285 0-3.85 1.7215-3.85 3.85 0 2.8875 3.85 7.15 3.85 7.15s3.85-4.2625 3.85-7.15c0-2.1285-1.7215-3.85-3.85-3.85zm0 5.225c-0.759 0-1.375-0.616-1.375-1.375s0.616-1.375 1.375-1.375 1.375 0.616 1.375 1.375-0.616 1.375-1.375 1.375z"/>\n                                    </g>  \n                                </svg>';t.marker=L.marker([],{icon:L.divIcon({html:e,iconSize:[24,24]}),draggable:!0})}function u(e){return document.querySelector(e)}function m(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)}function d(){i=[],s=-1,o.classList.remove("visible"),a.classList.remove("open"),r.value="",r.focus(),t.map&&t.marker&&t.map.removeLayer(t.marker)}function p(){a.innerHTML="";let e="";i.forEach(t=>{e+="<div>",e+=t.html,e+="</div>"}),e&&a.classList.add("open"),a.innerHTML=e}function f(e){var n,l;a.classList.remove("open"),r.value=i[e].html.replace("<strong>","").replace("</strong>",""),t.onSuggestSelected(i[e]),t.map&&(n=i[e],t.marker&&t.map.removeLayer(t.marker),void 0!==n.feature.coords?(t.map.panTo(n.feature.coords),t.marker&&(t.marker.setLatLng(n.feature.coords),t.map.addLayer(t.marker)),setTimeout(()=>t.map.setZoom(19))):(l=n.feature.id,fetch(`${t.apiUrl.replace("{lang}",t.lang)}/feature/${l}.json?key=${t.apiKey}`).then(e=>e.json())).then(e=>{"Point"===e.geometry.type?(t.map.panTo([e.geometry.coordinates[1],e.geometry.coordinates[0]]),t.marker&&(t.marker.setLatLng([e.geometry.coordinates[1],e.geometry.coordinates[0]]),t.map.addLayer(t.marker)),setTimeout(()=>t.map.setZoom(19))):t.map.fitBounds(function(e){let t=e.bbox||(e.geometry||{}).bbox;return t?[[t[1],t[0]],[t[3],t[2]]]:{}}(e),{animate:!0,maxZoom:17})}).catch(e=>{console.log("Error in API request: "+e),d()})),s=-1}function h(e,t){return 0===e.indexOf(t)}function g(){return"".concat.apply("",arguments)}function v(e){return e.filter(e=>e)}m(r,"input",function(){s=-1,clearTimeout(c),c=null,c=setTimeout(function(){let e=r.value;if(e.length>0){if(o.classList.add("visible"),e.length<t.minChars)return;i=[];let n=[];if(a.classList.remove("open"),(n=y.search(e)).length)return n.forEach(function(e){var t={html:y.format(e),feature:{coords:e}};i.push(t)}),void p();n=[],function(e){return fetch(`${t.apiUrl.replace("{lang}",t.lang)}/geocode.json?text=${e}&key=${t.apiKey}&limit=${t.suggestsLimit}`).then(e=>e.json())}(e).then(t=>{"FeatureCollection"===t.type?n=t.features:"Feature"===t.type&&n.push(t),n.forEach(t=>{(t.properties.name||t.properties.vitrine)&&i.push({html:function(e,t,n){let l=e.properties,r=l.categories,a=null;return h(r,"adm_country")?a=v([l.name]).join(""):h(r,"adm_district")?a=v([l.name," ",l.type," ",s(l.settlement_type,l.settlement)]).join(""):h(r,"adm_level1")?a=v([l.name,", ",l.country]).join(""):h(r,"adm_level2")?a=v([l.name,", ",l.country,", ",l.level1]).join(""):h(r,"adm_level3")?a=v([l.name,", ",l.level1,", ",l.level2]).join(""):h(r,"adm_settlement")?a=v([s(l.type,l.name)," ",l.level1," ",l.level2," ",l.level3]).join(""):h(r,"adr_street")?a=v([l.type," ",l.name,", ",s(l.settlement_type,l.settlement)," ",l.zone]).join(""):h(r,"adr_address")?a=v([l.settlement,", ",l.street_type," ",l.street,", ",l.name]).join(""):h(r,"poi")&&(a=v([l.vitrine," ",l.address]).join("")),o(a||l.name,t,n);function o(e,t,n){return n?e.length>=50?i(e.substring(0,55).concat("..."),t):i(e,t):e}function i(e,t){let n=e.toLowerCase(),l=t.toLowerCase();return n.indexOf(l)<0?e:g(e.substring(0,n.indexOf(l)),"<strong>",e.substring(n.indexOf(l),n.indexOf(l)+t.length),"</strong>",e.substring(n.indexOf(l)+t.length))}function s(e,t){return e?t+" "+e:t}}(t,e,!0),feature:t})}),p()}).catch(e=>{console.log("Error in API request: "+e),d()})}else d()},t.delay)}),m(document,"keydown",function(e){27===e.keyCode&&d()}),m(a,"click",function(e){f(Array.prototype.indexOf.call(e.target.parentNode.children,e.target))}),m(r,"keydown",function(e){if(13===e.keyCode)i.length>0&&f(s>0?s:0);else if(38===e.keyCode||40===e.keyCode){if(0===i.length)return;a.classList.contains("open")||a.classList.add("open"),a.childNodes.forEach(e=>e.classList.remove("selected")),(s=38===e.keyCode?s<0?i.length-1:s-1:s===i.length-1?-1:s+1)>=0&&a.childNodes[s].classList.add("selected")}}),m(r,"focus",function(e){a.childNodes.forEach(e=>e.classList.remove("selected")),i.length>0&&a.classList.add("open")}),m(o,"click",function(){d()}),m(u("body"),"click",function(e){e.target==this&&(s=-1,a.classList.remove("open"),r.blur())}),t.map&&t.map.on("click",function(){s=-1,a.classList.remove("open"),r.blur()});let y={search:function(e){if(0===e.length||e.trim().length<4)return[];let t=y.parse(e);if(null===t)return[];let n=[[t.lat,t.lng]];return-1!==e.search(/[NSEW]/)?n:(n.push([t.lng,t.lat]),n)},format:function(e){function t(e){let t={};return t.hemisphere=e>=0?1:-1,e=Math.abs(e),t.degrees=Math.floor(e),t.degreesDecimal=Math.min(9999,Math.round(1e4*(e-t.degrees))),e=60*e%60,t.minutes=Math.floor(e),t.minutesDecimal=Math.min(999,Math.round(1e3*(e-t.minutes))),e=60*e%60,t.seconds=Math.floor(e),t.secondsDecimal=Math.min(9,Math.floor(10*(e-t.seconds))),t}let n=t(e[0]),l=t(e[1]);return g(n="DDD°MM′SS″H".replace("H",1===n.hemisphere?"N":"S").replace("DDD",n.degrees).replace("MM",n.minutes).replace("SS",n.seconds)," ",l="DDD°MM′SS″H".replace("H",1===l.hemisphere?"E":"W").replace("DDD",l.degrees).replace("MM",l.minutes).replace("SS",l.seconds))},parse:function(e){function t(e,t){let n=(e=e.toUpperCase()).match(/[NEWS]/g);if(1===n.length){if("N"===n[0])return{lat:t[0],lng:t[1]};if("E"===n[0])return{lng:t[0],lat:t[1]};if("S"===n[0])return{lat:-t[0],lng:t[1]};if("W"===n[0])return{lng:-t[0],lat:t[1]}}else if(2===n.length){let e={};return"E"===n[0]?e.lng=t[0]:"W"===n[0]?e.lng=-t[0]:"N"===n[0]?e.lat=t[0]:"S"===n[0]&&(e.lat=-t[0]),"E"===n[1]?e.lng=t[1]:"W"===n[1]?e.lng=-t[1]:"N"===n[1]?e.lat=t[1]:"S"===n[1]&&(e.lat=-t[1]),e}}let n=e.match(/\d/g);if(null==n)return null;if(1.5*(null==n?0:n.length)<=(null==(n=e.match(/\D/g))?0:n.length))return null;if(null===(n=(e=(e=e.replace(/,/gim,".")).replace(/([+-])\s(\d+)/gim,"$1$2")).match(/[+-]?\d+[.,]?(?:\d+)?/gim)))return null;if(6===n.length||4===n.length){let l=function(e,t){let n=/^[+-]/,l="",r="",a=0,o=0;return 6===t.length?(null!==t[0].match(n)?(l=t[0].match(n),t[0]=t[0].replace(n,"")):l="+",null!==t[3].match(n)?(r=t[3].match(n),t[3]=t[3].replace(n,"")):r="+",a=parseFloat(t[0])+1/60*parseFloat(t[1])+1/3600*parseFloat(t[2]),o=parseFloat(t[3])+1/60*parseFloat(t[4])+1/3600*parseFloat(t[5]),[parseFloat(l+a),parseFloat(r+o)]):4===t.length?(null!==t[0].match(n)?(l=t[0].match(n),t[0]=t[0].replace(n,"")):l="+",null!==t[2].match(n)?(r=t[2].match(n),t[2]=t[2].replace(n,"")):r="+",a=parseFloat(t[0])+1/60*parseFloat(t[1]),o=parseFloat(t[2])+1/60*parseFloat(t[3]),[parseFloat(l+a),parseFloat(r+o)]):null}(0,n);return null!==/[news]/gi.exec(e)?t(e,l):{lat:parseFloat(l[0]),lng:parseFloat(l[1])}}return 2===n.length?null!==/[news]/gi.exec(e)?t(e,[parseFloat(n[0]),parseFloat(n[1])]):{lat:parseFloat(n[0]),lng:parseFloat(n[1])}:null}};return{clear:d}}}();"function"==typeof define&&define.amd?define("visicomAutoComplete",function(){return visicomAutoComplete}):"undefined"!=typeof module&&module.exports?module.exports=visicomAutoComplete:window.visicomAutoComplete=visicomAutoComplete;