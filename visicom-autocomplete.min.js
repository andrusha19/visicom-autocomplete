let visicomAutoComplete=function(){return function(e){let t={selector:"#visicom-autocomplete",apiUrl:"https://api.visicom.ua/data-api/4.0/{lang}/",proxyApiGeocodeUrl:"",proxyApiFeatureUrl:"",apiKey:"",placeholder:"Search...",minChars:3,delay:150,width:"400px",height:"35px",map:null,marker:null,suggestsLimit:5,lang:"local",onSuggestSelected:e=>console.log("Suggest selected: "+e.html)},l=p((t=Object.assign({},t,e)).selector);if(!l)return void console.log(`Couldn't find element with '${t.selector}' selector.`);let n=l.innerHTML.trim();l.classList.add("visicom-autocomplete"),l.style.width=t.width,l.style.height=t.height;let r=document.createElement("input");r.placeholder=t.placeholder,r.setAttribute("autocomplete","off"),r.setAttribute("autocorrect","off"),r.setAttribute("autocapitalize","off"),r.setAttribute("spellcheck","false");let a=document.createElement("div");a.classList.add("suggests");let o=document.createElement("button");if(o.classList.add("close"),o.style.width=t.height,o.style.height=t.height,l.appendChild(r),l.appendChild(a),l.appendChild(o),!n||!n.includes('href="https://api.visicom.ua/"'))return void console.log("Visicom link not available.");if(l.removeChild(l.firstElementChild),!t.apiKey&&!t.proxyApiGeocodeUrl&&!t.proxyApiFeatureUrl)return void console.log("You didn't specify your API key.");let i=[],s=-1,c=null,u=!1,m="";if(t.map&&!t.marker)if("undefined"==typeof L||null===L)console.log("Leaflet object is not available. Cannot create marker object.");else{let e='<svg xmlns="http://www.w3.org/2000/svg" \n                                        width="24" height="24" viewBox="0 0 24 24">\n\n                                    <defs>         \n                                        <filter id="blur1" x="-100%" y="-100%" width="400%" height="400%">             \n                                            <feGaussianBlur stdDeviation="2"></feGaussianBlur>\n                                        </filter>\n                                    </defs>\n                                    \n                                    <style>\n                                        .selected-bg {\n                                            fill: #808080;\n                                            filter: url(#blur1);\n                                        }\n                                        .selected-fill {\n                                            fill: #ffffff;\n                                            stroke: #ff0000;\n                                            stroke-width: 1.7px;\n                                        }\n                                    </style>    \n\n                                    <g>\n                                        <circle class="selected-bg" cx="12" cy="12" r="9"/>           \n                                        <circle class="selected-fill" cx="11" cy="11" r="9" />\n                                        <path fill="#ff0000" d="m11 5.7c-2.1285 0-3.85 1.7215-3.85 3.85 0 2.8875 3.85 7.15 3.85 7.15s3.85-4.2625 3.85-7.15c0-2.1285-1.7215-3.85-3.85-3.85zm0 5.225c-0.759 0-1.375-0.616-1.375-1.375s0.616-1.375 1.375-1.375 1.375 0.616 1.375 1.375-0.616 1.375-1.375 1.375z"/>\n                                    </g>  \n                                </svg>';t.marker=L.marker([],{icon:L.divIcon({html:e,iconSize:[24,24]}),draggable:!0})}function p(e){return document.querySelector(e)}function d(e,t,l){e.attachEvent?e.attachEvent("on"+t,l):e.addEventListener(t,l)}function f(){i=[],s=-1,o.classList.remove("visible"),a.classList.remove("open"),r.value="",r.focus(),t.map&&t.marker&&t.map.removeLayer(t.marker)}function h(){a.innerHTML="";let e="";i.forEach(t=>{e+="<div>",e+=t.html,e+="</div>"}),e&&a.classList.add("open"),a.innerHTML=e}function g(e){var l;a.classList.remove("open"),r.value=i[e].html.replace("<strong>","").replace("</strong>",""),t.onSuggestSelected(i[e]),t.map&&(l=i[e],t.marker&&t.map.removeLayer(t.marker),void 0!==l.feature.coords?(t.map.panTo(l.feature.coords),t.marker&&(t.marker.setLatLng(l.feature.coords),t.map.addLayer(t.marker)),setTimeout(()=>t.map.setZoom(19))):function(e){let l=t.proxyApiFeatureUrl?`${t.proxyApiFeatureUrl}?feature_id=${e}&lang=${t.lang}&key=${t.apiKey}`:`${t.apiUrl.replace("{lang}",t.lang)}/feature/${e}.json?key=${t.apiKey}`;return fetch(l).then(e=>e.json())}(l.feature.id).then(e=>{"Point"===e.geometry.type?(t.map.panTo([e.geometry.coordinates[1],e.geometry.coordinates[0]]),t.marker&&(t.marker.setLatLng([e.geometry.coordinates[1],e.geometry.coordinates[0]]),t.map.addLayer(t.marker)),setTimeout(()=>t.map.setZoom(19))):t.map.fitBounds(function(e){let t=e.bbox||(e.geometry||{}).bbox;return t?[[t[1],t[0]],[t[3],t[2]]]:{}}(e),{animate:!0,maxZoom:17})}).catch(e=>{console.log("Error in API request: "+e),f()})),s=-1}function y(e,t){return 0===e.indexOf(t)}function v(e){return e.filter(e=>e)}d(r,"input",function(){u?u=!1:(u=!1,s=-1,clearTimeout(c),c=null,c=setTimeout(function(){if((m=r.value).length>0){if(o.classList.add("visible"),m.length<t.minChars)return;i=[];let e=[];if(a.classList.remove("open"),(e=k.search(m)).length)return e.forEach(function(e){var t={html:k.format(e),feature:{coords:e}};i.push(t)}),void h();e=[],function(e){let l=t.proxyApiGeocodeUrl?`${t.proxyApiGeocodeUrl}?text=${e}&lang=${t.lang}&key=${t.apiKey}&limit=${t.suggestsLimit}`:`${t.apiUrl.replace("{lang}",t.lang)}/geocode.json?text=${e}&key=${t.apiKey}&limit=${t.suggestsLimit}`;return fetch(l).then(e=>e.json())}(m).then(t=>{"FeatureCollection"===t.type?e=t.features:"Feature"===t.type&&e.push(t),e.forEach(e=>{(e.properties.name||e.properties.vitrine)&&i.push({html:function(e,t,l){let n=e.properties,r=n.categories,a=null;return y(r,"adm_country")?a=v([n.name]).join(""):y(r,"adm_district")?a=v([n.name," ",n.type," ",s(n.settlement_type,n.settlement)]).join(""):y(r,"adm_level1")?a=v([n.name,", ",n.country]).join(""):y(r,"adm_level2")?a=v([n.name,", ",n.country,", ",n.level1]).join(""):y(r,"adm_level3")?a=v([n.name,", ",n.level1,", ",n.level2]).join(""):y(r,"adm_settlement")?a=v([s(n.type,n.name)," ",n.level1," ",n.level2," ",n.level3]).join(""):y(r,"adr_street")?a=v([n.type," ",n.name,", ",s(n.settlement_type,n.settlement)," ",n.zone]).join(""):y(r,"adr_address")?a=v([n.settlement,", ",n.street_type," ",n.street,", ",n.name]).join(""):y(r,"poi")&&(a=v([n.vitrine," ",n.address]).join("")),o(a||n.name,t,l);function o(e,t,l){return l?e.length>=50?i(e.substring(0,55).concat("..."),t):i(e,t):e}function i(e,t){let l=e.toLowerCase(),n=t.toLowerCase();return l.indexOf(n)<0?e:`${e.substring(0,l.indexOf(n))}<strong>${e.substring(l.indexOf(n),l.indexOf(n)+t.length)}</strong>${e.substring(l.indexOf(n)+t.length)}`}function s(e,t){return e?t+" "+e:t}}(e,m,!0),feature:e})}),h()}).catch(e=>{console.log("Error in API request: "+e),f()})}else f()},t.delay))}),d(document,"keydown",function(e){27===e.keyCode&&f()}),d(a,"click",function(e){g(Array.prototype.indexOf.call(e.target.parentNode.children,e.target))}),d(r,"keydown",function(e){if(13===e.keyCode)i.length>0&&g(s>0?s:0);else if(38===e.keyCode||40===e.keyCode){if(e.preventDefault(),0===i.length)return;a.classList.contains("open")||a.classList.add("open"),a.childNodes.forEach(e=>e.classList.remove("selected")),(s=38===e.keyCode?s<0?i.length-1:s-1:s===i.length-1?-1:s+1)>=0?(r.value=i[s].html.replace("<strong>","").replace("</strong>",""),a.childNodes[s].classList.add("selected")):(r.value=m,r.setSelectionRange(m.length,m.length))}}),d(r,"focus",function(e){a.childNodes.forEach(e=>e.classList.remove("selected")),i.length>0&&a.classList.add("open")}),d(o,"click",function(){f()}),d(p("body"),"click",function(e){e.target==this&&(s=-1,a.classList.remove("open"),r.blur())}),t.map&&t.map.on("click",function(){s=-1,a.classList.remove("open"),r.blur()});let k={search:function(e){if(0===e.length||e.trim().length<4)return[];let t=k.parse(e);if(null===t)return[];let l=[[t.lat,t.lng]];return-1!==e.search(/[NSEW]/)?l:(l.push([t.lng,t.lat]),l)},format:function(e){function t(e){let t={};return t.hemisphere=e>=0?1:-1,e=Math.abs(e),t.degrees=Math.floor(e),t.degreesDecimal=Math.min(9999,Math.round(1e4*(e-t.degrees))),e=60*e%60,t.minutes=Math.floor(e),t.minutesDecimal=Math.min(999,Math.round(1e3*(e-t.minutes))),e=60*e%60,t.seconds=Math.floor(e),t.secondsDecimal=Math.min(9,Math.floor(10*(e-t.seconds))),t}let l=t(e[0]),n=t(e[1]);return`${l="DDD°MM′SS″H".replace("H",1===l.hemisphere?"N":"S").replace("DDD",l.degrees).replace("MM",l.minutes).replace("SS",l.seconds)} ${n="DDD°MM′SS″H".replace("H",1===n.hemisphere?"E":"W").replace("DDD",n.degrees).replace("MM",n.minutes).replace("SS",n.seconds)}`},parse:function(e){function t(e,t){let l=(e=e.toUpperCase()).match(/[NEWS]/g);if(1===l.length){if("N"===l[0])return{lat:t[0],lng:t[1]};if("E"===l[0])return{lng:t[0],lat:t[1]};if("S"===l[0])return{lat:-t[0],lng:t[1]};if("W"===l[0])return{lng:-t[0],lat:t[1]}}else if(2===l.length){let e={};return"E"===l[0]?e.lng=t[0]:"W"===l[0]?e.lng=-t[0]:"N"===l[0]?e.lat=t[0]:"S"===l[0]&&(e.lat=-t[0]),"E"===l[1]?e.lng=t[1]:"W"===l[1]?e.lng=-t[1]:"N"===l[1]?e.lat=t[1]:"S"===l[1]&&(e.lat=-t[1]),e}}let l=e.match(/\d/g);if(null==l)return null;if(1.5*(null==l?0:l.length)<=(null==(l=e.match(/\D/g))?0:l.length))return null;if(null===(l=(e=(e=e.replace(/,/gim,".")).replace(/([+-])\s(\d+)/gim,"$1$2")).match(/[+-]?\d+[.,]?(?:\d+)?/gim)))return null;if(6===l.length||4===l.length){let n=function(e,t){let l=/^[+-]/,n="",r="",a=0,o=0;return 6===t.length?(null!==t[0].match(l)?(n=t[0].match(l),t[0]=t[0].replace(l,"")):n="+",null!==t[3].match(l)?(r=t[3].match(l),t[3]=t[3].replace(l,"")):r="+",a=parseFloat(t[0])+1/60*parseFloat(t[1])+1/3600*parseFloat(t[2]),o=parseFloat(t[3])+1/60*parseFloat(t[4])+1/3600*parseFloat(t[5]),[parseFloat(n+a),parseFloat(r+o)]):4===t.length?(null!==t[0].match(l)?(n=t[0].match(l),t[0]=t[0].replace(l,"")):n="+",null!==t[2].match(l)?(r=t[2].match(l),t[2]=t[2].replace(l,"")):r="+",a=parseFloat(t[0])+1/60*parseFloat(t[1]),o=parseFloat(t[2])+1/60*parseFloat(t[3]),[parseFloat(n+a),parseFloat(r+o)]):null}(0,l);return null!==/[news]/gi.exec(e)?t(e,n):{lat:parseFloat(n[0]),lng:parseFloat(n[1])}}return 2===l.length?null!==/[news]/gi.exec(e)?t(e,[parseFloat(l[0]),parseFloat(l[1])]):{lat:parseFloat(l[0]),lng:parseFloat(l[1])}:null}};return{clear:f}}}();"function"==typeof define&&define.amd?define("visicomAutoComplete",function(){return visicomAutoComplete}):"undefined"!=typeof module&&module.exports?module.exports=visicomAutoComplete:window.visicomAutoComplete=visicomAutoComplete;